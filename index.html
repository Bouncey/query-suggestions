<!DOCTYPE html>
<html>
  <head>
    <title>Algolia Search for Popular Searches test</title>

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
    <style>
*, *:after, *:before {
  font-family: Open Sans, sans-serif;
  box-sizing: border-box;
}

h1 {
  text-align: center;
}

.algolia-autocomplete {
  width: 100%;
}

#search_input {
  width: 100%;
  padding: 8px 16px;
}

.aa-dropdown-menu {
  position: relative;
  width: 100%;
  margin-top: 16px;
  background: #ffffff;
  border: 2px solid #e8e8e8;
}

.aa-dropdown-menu:after, .aa-dropdown-menu:before {
  bottom: 100%;
  right: 20px;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.aa-dropdown-menu:after {
  border-color: rgba(255, 255, 255, 0);
  border-bottom-color: #ffffff;
  border-width: 12px;
  margin-left: -12px;
  right: 22px;
}

.aa-dropdown-menu:before {
  border-color: rgba(232, 232, 232, 0);
  border-bottom-color: #e8e8e8;
  border-width: 14px;
  margin-left: -14px;
}

.aa-suggestion {
  padding: 8px 8px;
  border-bottom: 1px solid #ebebeb;
  cursor: pointer;
}

.aa-suggestion.aa-cursor {
  background: #f8f8f8;
}

.highlight {
  font-weight: bold;
}

.aa-footer {
  font-size: 0.95em;
}
    </style>
  </head>
  <body>
    <select id="index_selector">
      <option value="hackernews" selected>HackerNews</option>
      <option value="instant_search">Instant Search demo</option>
    </select>

    <h1 id="title">Search in HackerNews popular searches</h1>
    <input id="search_input" type="text" autocomplete="off" placeholder="Search for HackerNews topics" autofocus="autofocus" />

    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
    <script>
      var AVAILABLE = {
        hackernews: {
          title: 'HackerNews',
          placeholder: 'Search for HackerNews topics',
          url: 'https://hn.algolia.com/?q='
        },
        instant_search: {
          title: 'Instant Search demo',
          placeholder: 'Search for products suggestions',
          url: 'https://demos.algolia.com/instant-search-demo/?q='
        }
      };

      var $index_selector = document.getElementById('index_selector');
      var $title = document.getElementById('title');
      var $search_input = document.getElementById('search_input');

      var index = $index_selector.value;
      var client = algoliasearch('OMDED4ZQES', '24c5f81bb301609f7dced52863634ec6')
      var aa = null;

      function createAutocomplete () {
        var query = null;
        $title.innerText = AVAILABLE[index].title + ' popular searches';
        $search_input.placeholder = AVAILABLE[index].placeholder;
        aa = autocomplete('#search_input', { debug: true, hint: false }, [
          {
            source: autocomplete.sources.hits(client.initIndex(index + '_popular_searches'), { hitsPerPage: 8, highlightPreTag: '<span class="highlight">', highlightPostTag: '</span>' }),
            displayKey: 'query',
            templates: {
              suggestion: function(suggestion) {
                return suggestion._highlightResult.query.value;
              },
              footer: function(opts) {
                query = opts.query;
                return '<div class="aa-suggestion aa-footer">Search for results matching "' + query + '"</div>'
              }
            }
          }
        ]).on('autocomplete:selected', function(event, suggestion, dataset) {
          if (suggestion === undefined) {
            suggestion = {
              query: query
            };
          }
          window.location.href = AVAILABLE[index].url + encodeURIComponent(suggestion.query);
        });
        $search_input.focus();
      }
      createAutocomplete();

      $index_selector.addEventListener('change', function () {
        index = $index_selector.value;
        aa.autocomplete.destroy();
        createAutocomplete();
      });
    </script>
  </body>
</html>
